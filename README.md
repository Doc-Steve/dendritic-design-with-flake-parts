<h1 align="center"> Dendritc Design</h1>
<h3 align="center"> with the Flake Parts Framework</h3>

<p align="center">
<a href="https://github.com/mightyiam/dendritic"> <img src="https://img.shields.io/badge/Dendritic--Pattern-Nix-informational?logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAA5CAYAAAB0+HhyAAAAAXNSR0IB2cksfwAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAbpJREFUaN7tWcGuwyAMW6L9/y/nXTZpr4PiJA6sqJwmrZQYjOOk8igcZmbv3yIilWvpY9L4BHVpINXjBnIDKRrP1arEUjZlgIiokr0GS9mo1GoFN0uKJUMBdkCt96J00wyt5DUYALLv0ch96O3kCgD0O+INqvdslK5ypApLJnsBjea25o1Ai4gIOvH4XARMdAOO81rPaEWOYCiXB8RpZkfoNtPuDwUnsusoOBa1kFg0ojozqYaqpLJywioAp5cdOZ2KU8kkXmEEiiY3RhLsvYObXQdSiUppZC312HAm3bL+7WuToi9F5rROpGotyfgi5qXP+jeJJi4mIM96PS8mTEsSzcrZ4s5V6s7KB+mafYsT2eaObKtal80jmeDOAjmjLHutbbzW3u63zNglTae7HkF2aGY7CFlbq0DM7rQoWov8WvPhGK9mi6mK5oKnf/CO/flr9Bm5jNb/ZmaK7soqkKhg6L/sCDbpop/XmL7sK+6M48wIAfMTRrdBN6MeiTar3Q06zy5lKTMyk8ipbPNVt6SsHXVnKvKWsncUokGBfCuD15HgWqAzAEsTG6OpsYRaK8cN5AZyRSAzXfIf7j4IjUJ5XtMAAAAASUVORK5CYII=&logoColor=white" alt="Dendritic Pattern"/></a>
<a href="https://flake.parts/"><img src="https://img.shields.io/badge/Flake%20Parts-Nix-informational?logoSize=auto&logoColor=white&logo=data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB3aWR0aD0iMzcuMzcyOTFtbSIKICAgaGVpZ2h0PSI0NS4zMTE5NzRtbSIKICAgdmlld0JveD0iMCAwIDM3LjM3MjkwOSA0NS4zMTE5NzMiCiAgIHZlcnNpb249IjEuMSIKICAgaWQ9InN2ZzExNTIiCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPGRlZnMKICAgICBpZD0iZGVmczExNDkiIC8+CiAgPGcKICAgICBpZD0ibGF5ZXIxIgogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0zOS4xMTkzNDksLTExMy4yMDM5OCkiPgogICAgPHBhdGgKICAgICAgIGlkPSJwYXRoNDg5OCIKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjcuOTM3O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZSIKICAgICAgIGQ9Im0gNDYuNTkzODI4LDExMy4yMDM5OCAtMy43MzcyNCw2LjQ3Mjk5IDcuNDc0NDc5LDEyLjk0NTk4IC03LjQ3NDQ3OSwxMi45NDY1IC0zLjczNzIzOSw2LjQ3Mjk5IDMuNzM3MjM5LDYuNDczNTEgaCA3LjQ3NDQ3OSBsIDcuNDc0NDc5LC0xMi45NDY1IDcuNDc0OTk2LDEyLjk0NjUgaCA3LjQ3NDQ3OSBsIDMuNzM3MjQsLTYuNDczNTEgLTMuNzM3MjQsLTYuNDcyOTkgLTcuNDc0NDc5LC0xMi45NDY1IC03LjQ3NDk5NiwtMTIuOTQ1OTggLTMuNzM3MjM5LC02LjQ3Mjk5IHoiIC8+CiAgPC9nPgo8L3N2Zz4K&link=https://flake.parts/" alt="Flake Parts" /></a>
<a href="https://nixos.org"><img alt="NixOS" src="https://img.shields.io/badge/NixOS-5277C3?logo=nixos&logoColor=fff" /></a>
<a href="https://github.com/nix-darwin/nix-darwin"> <img src="https://img.shields.io/badge/Nix--Darwin-5277C3?logo=apple&logoColor=fff" alt="Dendritic Pattern"/></a>
<a href="https://github.com/nix-community/home-manager"> <img src="https://img.shields.io/badge/Home--Manager-Nix-informational?logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAAXNSR0IB2cksfwAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAMAQAADAEB9phnUAAAAAd0SU1FB+kMDxInMm28iUYAAARGSURBVGje7ZldiFVVFMf/646j5lRIGakN2oA2TWFhYfYd81AJQhDTByaIlJJCRUElZZ+UpfXQQxREiVEhKBiID1kpOqE9RA4p6VDJmEJkRFbTVDPNx6+XPXQ47X3uveeefbkPLrgP9+z1sf97r73O2v8jnZbGEqvFGOiS1CqpJKnbzHoCehMlLZPU5H4l9ztpZlsDNoslzXZ/95rZkSgrAMwDhvlPjgATMvQ/4P8yAsz36M4FhhJ6XwKlGCAM2OWZ2IMZNq3AgMdmL2Ap3R0evftiACkBPZ5gvwDnZNg9jV/uSOgsCui8Giu1bgwEfD3D5gzgmMemD5gMNAO9nvGfgKnRKgWw1RN0GLgkw+bOwAI8ATwSGFsRteQBFwJ/ewLvLHO+uj02/cCvnucHohx0z8TWBVZxcYbNfFexyskYcF2h7xGgRVKL+zs2/ljSFEk9kqalTL6R1ClpxOkpYYukDZJWlgm72cyWFl2lDlCsrAJ+yxgfAFqLTp/lFC99wNqM8aeqmWOpwpRaF+F4tUma6FIwLWOS3ip6N54nngwA9wfGXi6saQRmSjrsDnQs2SxpuqRFqeeDki41s77o3a8De6akJc5X0t/3ZvZxhT4ulnRIUnNq6EMz66rLPQBYH0iNW6v081rAT2c9QMwBBj3Bd+TwNRX42ePrK6ApNpDtnsBDwEU5/a0K7MrCmCBuKbrdBpqAgyl/u9P3lSJBNAOHPSBOAmfX6LszdYO8rBK7CZ5yuzzRR+HprSSpQ5KvVV9rZv01kQhme4BtkrokvWNmh/Ksxvs1vNwKa7eBNuBH4Lw8xte4tjmvXF9w+rbl7bXOreEFuUXSiUJ5KrNjtazCzhw78SewOhplk6fXAtolrQ7s2AJJV3t8vOQOZrukFWa2sWHpSGAS8J1nN06k7hQ1l9/YQNYE0uohD2HwSqOCmOEYjrTsA17wPB8E5jYikHc9kx0FrnT8r48N2d5oIBa6SadlY0LnjUDa3dxIQN72TPB3YHpCZxpwyqP3dRY7X28g7Sl6H+Axj97DgV15EjjufMT6fVIpmA2JiX0LTAp0w70Bdv7RiOTFKHBFpUDOAn5whrdl6N0bCPYm8EUkIJuqTbGl5bYQ+CwQbBhYWWNDGqKSZlYLxIALMsbvLhP00xqvCD55pmg6aIqkXkmzyqjeJWmXi1lKzaFD0h4P87nNEd2lxFzHdU6Z2UiRle25ClfwKDC5ylI/ClxVj/I8C/grUK18sibD1/nuHZWWz6ORD4ngWwIfZ64NfIboB2Zk+Hs8sAD3xARxUyDoe278hkCl2lTmunA0cF1oiQGi5OGfAP5IlsTAjo0CCzJ83x5YoGdj7chHvi+zKZ3ZgTO0PyvvHSmXlgdiAekA/klVJV/78mK1eQ9cnroelG1Ac3enZtYLLJM0xz3abWZDHtX1koYThB+O8GvK8H0QWCJpPE27C31nnJY6yL9F+cbMnhkZewAAAABJRU5ErkJggg==&logoColor=white" alt="Home Manager"/></a>
</p>

<h3 align="center"> A guide on how to structure your Nix code with Flake Parts using the Dendritic Pattern </h3>
<p align="center">
  <img src="https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/line2.png" width="600" height="5" />
</p>

As with many other programming languages, Nix offers numerous alternative approaches to implementing the desired outcome. While this freedom brings certain advantages, it also presents some drawbacks.

Some Nix users might find this journey relatable:<br/>
*As a beginner, you start with a single `configuration.nix` file. However, as your requirements grow, such as managing multiple hosts, users, and self-defined services, you redesign your code structure multiple times. Each iteration makes your code increasingly complex. The complexity reaches a new level when you integrate Home-Manager into your system configuration and when you use your code simultaneously for Linux and MacOS.*

With increasing experience, you desire:<img align="right" height="200" src="https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/blocks.png">
- **Reusable code** that can be easily integrated into various areas or foreign code that can be used without significant changes to your existing code.
- **Simple troubleshooting** that enables quick identification and resolution of errors in a single location.
- **A logical and easily expandable structure** that minimizes complexity and enhances manageability.

While there are software frameworks available that offer ready-made system configuration tools with precisely defined fixed structures, a more effective approach is to shift our mindset about **how we build and structure our own Nix code**, the [Dendritic Pattern](https://github.com/mightyiam/dendritic). 

This new approach eliminates the need to depend on a limited toolset that may not meet your future needs. It offers a design approach that directly addresses your pain points.

This guide aims to provide guidance on migrating existing code structures or assist you in planning a new (complex) structure from scratch. All the concepts and code snippets presented should be considered as ideas to ponder, which can always be adapted or expanded to suit your specific requirements.

For users solely relying on Nix to run a single machine, this guide may be overly detailed. However, it's beneficial for those contemplating refactoring their existing configuration, particularly when faced with design challenges arising from increased complexity.

Furthermore, this guide includes a [Comprehensive Example](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Comprehensive_Example#comprehensive-example) that demonstrates the typical usage of the Dendritic Design. The example primarily focuses on illustrating the code structure aspects outlined in this guide. While it's not meant to be a direct copy template, it serves as a valuable resource for incorporating ideas into your own design.

If you have any questions before you begin, please refer to the provided [FAQ](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/FAQ).

# Contents

- [Basics for usage of the Dendritic Pattern](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Basics#basics-for-usage-of-the-dendritic-pattern)
  - [Libraries](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Basics#libraries)
  - [What is a *feature* ?](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Basics#what-is-a-feature-)
  - [File Organization](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Basics#file-organization)
  - [The Flake Parts Framework](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Basics#the-flake-parts-framework)
- [Design Patterns for Dendritic Aspects](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Dendritic_Aspects#design-patterns-for-dendritic-aspects)
  - [***Simple Aspect***](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Dendritic_Aspects#simple-aspect)
  - [***Multi Context Aspect***](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Dendritic_Aspects#multi-context-aspect)
  - [***Inheritence Aspect***](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Dendritic_Aspects#inheritence-aspect)
  - [***Collector Aspect***](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Dendritic_Aspects#collector-aspect)
  - [***Constants Aspect***](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Dendritic_Aspects#constants-aspect)
  - [***DRY Aspect***](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Dendritic_Aspects#dry-aspect)
  - [***Factory Aspect***](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Dendritic_Aspects#factory-aspect)
  - [Applying and Selecting Aspect Patterns](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Dendritic_Aspects#applying-and-selecting-aspect-patterns)
  - [Bringing it all together](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Dendritic_Aspects#bringing-it-all-together)
- [Comprehensive Example](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Comprehensive_Example#comprehensive-example)
- [Acknowledgement and additional information](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Acknowledgement_and_additional_information#acknowledgement-and-additional-information)
  - [Dendritic Pattern](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Acknowledgement_and_additional_information#dendritic-pattern)
  - [Flake-Parts](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Acknowledgement_and_additional_information#flake-parts)
  - [Optional libraries](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Acknowledgement_and_additional_information#optional-libraries)
  - [Reference repositories utilizing the Dendritic Pattern](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/Acknowledgement_and_additional_information#reference-repositories-utilizing-the-dendritic-pattern)

- [Frequently Asked Questions](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/FAQ.md)
  - [What is it? Why should I care?](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/FAQ#what-is-it-why-should-i-care)
  - [What are the advantages?](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/FAQ#what-are-the-advantages)
  - [Why is the definition of the Dendritic Pattern so complicated? What if I don't understand everything?](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/FAQ#why-is-the-definition-of-the-dendritic-pattern-so-complicated-what-if-i-dont-understand-everything)
  - [Is Flake-Parts the Dendritic Pattern? Why use two names?](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/FAQ#is-flake-parts-the-dendritic-pattern-why-use-two-names)
  - [Should I start  my config design with the Dendritic Pattern? Is a migration worth it?](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/FAQ#should-i-start--my-config-design-with-the-dendritic-pattern-is-a-migration-worth-it)
  - [Is it only useful for cross-platform development, or is there more to it?](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/FAQ#is-it-only-useful-for-cross-platform-development-or-is-there-more-to-it)
  - [Dendritic Pattern seems just like a "buzzword", why is this different from what I'm already doing for the configuration of my hosts?](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/FAQ#dendritic-pattern-seems-just-like-a-buzzword-why-is-this-different-from-what-im-already-doing-for-the-configuration-of-my-hosts)
  - [How does it compare to other template repositories / host management tools?](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/FAQ#how-does-it-compare-to-other-template-repositories--host-management-tools)
  - [I already use modules, why should I put an abstraction layer on top?](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/FAQ#i-already-use-modules-why-should-i-put-an-abstraction-layer-on-top)
  - [Should I use Flake-Parts and what are the alternatives?](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/FAQ#should-i-use-flake-parts-and-what-are-the-alternatives)
  - [Is it mandatory for me to learn all the `Aspect` patterns mentioned in the guide?](https://github.com/Doc-Steve/dendritic-design-with-flake-parts/wiki/FAQ#is-it-mandatory-for-me-to-learn-all-the-aspect-patterns-mentioned-in-the-guide)
